
--ALTA PARA GRADO_SERVICIO
--SI SE QUIERE INGRESAR REGISTROS EN GRADO_SERVICIO Y NO EXISTEN REGISTROS EN NIVEL_GRADO, ENTONCES MANDA UN ERROR,
--MEDIANTE LA EXCEPCIÓN SE CONTROLA DICHO ERROR
CREATE OR REPLACE PROCEDURE ALTA_GRADO_SERVICIO(PRECIO$ IN NUMBER,IDNIVEL$ IN NUMBER,IDGRADO$ IN NUMBER,IDSERVICIO$ IN NUMBER)
AS 
	PRECIO_ACTUAL$ 	NUMBER(11,2);
	REGS_NIVELGRADO$ NUMBER(8);
	REGS_SERVICIO$ NUMBER(8);
BEGIN
	SELECT COUNT(*) INTO REGS_NIVELGRADO$ FROM NIVEL_GRADO;
	SELECT COUNT(*) INTO REGS_SERVICIO$ FROM SERVICIO;
	IF (REGS_NIVELGRADO$ > 0) AND (REGS_SERVICIO$ > 0) THEN
		SELECT PRECIO INTO PRECIO_ACTUAL$ FROM GRADO_SERVICIO WHERE IDNIVEL=IDNIVEL$ AND IDGRADO=IDGRADO$ AND IDSERVICIO=IDSERVICIO$;
		IF(PRECIO_ACTUAL$ IS NOT NULL) THEN
				DBMS_OUTPUT.PUT_LINE('EL PRECIO PARA '||IDSERVICIO$||' EN '||IDGRADO$||' NIVEL ('||IDNIVEL$||') YA EXISTE');
		END IF;
	ELSE
		DBMS_OUTPUT.PUT_LINE('NO HAY REGISTROS PADRES EN TABLA NIVEL_GRADO');
	END IF;

	EXCEPTION
	WHEN NO_DATA_FOUND THEN
		INSERT INTO GRADO_SERVICIO(PRECIO,IDNIVEL,IDGRADO,IDSERVICIO) VALUES(PRECIO$,IDNIVEL$,IDGRADO$,IDSERVICIO$);
		DBMS_OUTPUT.PUT_LINE('SE AGREGO EL PRECIO');
		COMMIT;
END ALTA_GRADO_SERVICIO;
/

CREATE OR REPLACE PROCEDURE BAJA_GRADO_SERVICIO(VIDNIVEL IN NUMBER,VIDGRADO IN NUMBER,VIDSERVICIO IN NUMBER)
AS
BEGIN
	DELETE FROM GRADO_SERVICIO WHERE IDNIVEL=VIDNIVEL AND IDGRADO=VIDGRADO AND IDSERVICIO=VIDSERVICIO;
	IF SQL%NOTFOUND THEN
		DBMS_OUTPUT.PUT_LINE('NO SE ELIMINÓ GRADO_SERVICIO ALGUNO');
	ELSE
		DBMS_OUTPUT.PUT_LINE('HA SIDO ELIMINADO EL GRADO_SERVICIO');
		COMMIT;
	END IF;
END BAJA_GRADO_SERVICIO;
/


CREATE OR REPLACE PROCEDURE ACTUALIZA_GRADO_SERVICIO(VIDNIVEL IN NUMBER,VIDGRADO IN NUMBER,VIDSERVICIO IN NUMBER,VPRECIO IN NUMBER)
AS
BEGIN
	UPDATE GRADO_SERVICIO SET PRECIO=VPRECIO
		WHERE IDNIVEL=VIDNIVEL AND IDGRADO=VIDGRADO AND IDSERVICIO=VIDSERVICIO;
	IF SQL%NOTFOUND THEN
		DBMS_OUTPUT.PUT_LINE('NO EXISTE EL SERVICIO A ACTUALIZAR');
	ELSE
		DBMS_OUTPUT.PUT_LINE('SE ACTUALIZÓ EL SERVICIO');
		COMMIT;
	END IF;
END ACTUALIZA_GRADO_SERVICIO;
/
